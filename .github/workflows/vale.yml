name: Vale Linter

on: [pull_request]

jobs:
  lint:
    name: Run Vale and Reviewdog
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Vale
      uses: reviewdog/action-setup@v1
      with:
        tool: 'vale'
        vale_version: 'latest' # Specify the version you need

    - name: Run Vale
      id: vale
      run: |
        vale --output=JSON . > vale_output.json

    - name: Install reviewdog
      uses: reviewdog/action-setup@v1
      with:
        reviewdog_version: 'latest'

    - name: Run reviewdog
      uses: reviewdog/action-reviewdog@v1
      with:
        name: 'vale'
        reporter: 'github-pr-check'
        level: 'error'
        filter_mode: 'added'
        fail_on_error: true
        reviewdog_flags: '-f=vale'
        input: 'vale_output.json'
        github_token: ${{ secrets.GITHUB_TOKEN }}
